webpackJsonp([6],{"8oTS":function(t,e){},pi0s:function(t,e){},wuqv:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("LGwj"),s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.title,visible:t.addDialogVisible,width:"40%"},on:{"update:visible":function(e){t.addDialogVisible=e}}},[a("div",{staticClass:"ui-box leave_dialog"},[a("el-form",{ref:"formPerms",attrs:{model:t.departmentItem,"label-width":"80px",rules:t.formRule}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{staticClass:"item_reset",attrs:{size:"mini"},model:{value:t.departmentItem.name,callback:function(e){t.$set(t.departmentItem,"name",e)},expression:"departmentItem.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"说明"}},[a("el-input",{staticClass:"item_reset",attrs:{size:"mini"},model:{value:t.departmentItem.description,callback:function(e){t.$set(t.departmentItem,"description",e)},expression:"departmentItem.description"}})],1)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t.addDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.submit}},[t._v("确 定")])],1)])},staticRenderFns:[]};var n=a("VU/8")({name:"addItem",props:{departmentItem:{}},data:function(){return{formRule:{name:[{required:!0,message:"请输入名称",trigger:"blur"}]},addDialogVisible:!1,title:"",parentRoute:[]}},mounted:function(){this.initParentRoute()},methods:{submit:function(){var t=this;this.$refs.formPerms.validate(function(e){e&&t.$emit("submit")})},openWindow:function(t){this.title=t,this.addDialogVisible=!0},initParentRoute:function(){this.parentRoute=this.$getGlobal.getItem("routers")}}},s,!1,function(t){a("8oTS")},null,null).exports,r={name:"departmentList",components:{pageBox:i.a,addItem:n},data:function(){return{dataList:[],exportList:[],departmentItem:{name:"",description:""},userList:[],params:{departmentId:"",name:"",description:""},addUserItem:"",tabLoading:!1,addUserFlag:!1,editDepartFlag:!1,departTmpItem:{}}},created:function(){this.getData()},methods:{getData:function(){var t=this;this.tabLoading=!0,post("/pms_api/department/list",this.params).then(function(e){t.dataList=e.rows,t.getUserByDepartment()}).catch(function(e){console.log(e),t.tabLoading=!1})},addItem:function(){var t=this;post("/pms_api/department/add",this.departmentItem).then(function(e){t.$refs.addPerm.addDialogVisible=!1,t.getData()}).catch(function(t){console.log(t)}),this.$refs.addPerm.addDialogVisible=!1},open:function(){this.$refs.addPerm.openWindow("新增部门")},openEdit:function(t){this.departTmpItem=t,this.editDepartFlag=!0},editItem:function(){var t=this;post("/pms_api/department/edit",this.departTmpItem).then(function(e){t.editDepartFlag=!0,t.getData()}).catch(function(t){console.log(t)})},deleteItem:function(t){var e=this;post("/pms_api/department/delete",{departmentId:t.departmentId}).then(function(t){e.getData()}).catch(function(t){console.log(t)})},checkUserDetail:function(t){this.$router.push({path:"/userDetail",query:{title:t.name,id:t.userId}})},openDialog:function(t){this.departTmpItem=t,this.getUsers(),this.addUserFlag=!0},getUsers:function(){var t=this;post("/pms_api/user/list").then(function(e){for(var a in t.userList=e.rows,t.dataList)for(var i in t.dataList[a].userList)for(var s in t.userList)t.userList[s].userId==t.dataList[a].userList[i].userId&&(t.userList[s].select="1")}).catch(function(t){console.log(t)})},addUserToDepart:function(){var t=this,e=[];for(var a in this.departTmpItem.userList)e.push(this.departTmpItem.userList[a].userId);e.push(this.addUserItem),post("/pms_api/department/assign/department",{departmentId:this.departTmpItem.departmentId,userIdStr:e}).then(function(e){t.addUserFlag=!1,t.getData()}).catch(function(t){console.log(t)})},getUserByDepartment:function(){var t=this,e=function(e){post("/pms_api/department/assign/department/list/",{departmentId:t.dataList[e].departmentId}).then(function(a){t.dataList[e].userList=a.rows}).catch(function(t){console.log(t)})};for(var a in this.dataList)e(a);this.tabLoading=!1},deleteUserByDepartment:function(t,e){var a=this,i=[];for(var s in this.dataList[e].userList)this.dataList[e].userList[s].userId!=t.userId&&i.push(this.dataList[e].userList[s].userId);post("/pms_api/department/assign/department",{departmentId:this.dataList[e].departmentId,userIdStr:i}).then(function(t){a.getData()}).catch(function(t){console.log(t)})},handleSelectionChange:function(t){this.exportList=t},exportExcel:function(){this.$message.warning("抱歉，无法导出")},cellStyle:function(t){t.row,t.colum,t.rowIndex,t.columIndex;return"text-align: center"},rowClass:function(t){t.row,t.rowIndex;return"text-align: center"}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("page-box",[a("div",{staticClass:"ui-search-box",attrs:{slot:"search-form"},slot:"search-form"},[a("el-form",{staticClass:"ui-search-form",attrs:{"label-width":"120px"}},[a("el-form-item",{attrs:{label:"部门id"}},[a("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",clearable:""},model:{value:t.params.departmentId,callback:function(e){t.$set(t.params,"departmentId",e)},expression:"params.departmentId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",clearable:""},model:{value:t.params.name,callback:function(e){t.$set(t.params,"name",e)},expression:"params.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"说明"}},[a("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",clearable:""},model:{value:t.params.description,callback:function(e){t.$set(t.params,"description",e)},expression:"params.description"}})],1)],1),t._v(" "),a("div",{staticClass:"ui-search-btus"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.getData}},[t._v("搜索")])],1)],1),t._v(" "),a("div",{staticClass:"ui-list ui-box",attrs:{slot:"list-box"},slot:"list-box"},[a("div",{staticClass:"box-header ui-list-header"},[a("div",[t._v("部门列表")]),t._v(" "),a("div",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.exportExcel}},[t._v("导出")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.open}},[t._v("新增")])],1)]),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tabLoading,expression:"tabLoading"}],attrs:{data:t.dataList,"cell-style":t.cellStyle,"header-cell-style":t.rowClass},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.userList.length>0?a("el-table",{staticStyle:{color:"#AE3939"},attrs:{data:e.row.userList,"cell-style":t.cellStyle,"header-cell-style":t.rowClass},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"userId",label:"用户id"}}),t._v(" "),a("el-table-column",{attrs:{prop:"username",label:"用户名"}}),t._v(" "),a("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),t._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"手机号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"sex",label:"性别"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.sex?a("span",[t._v("男")]):a("span",[t._v("女")])]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(t){return[1==t.row.status?a("el-button",{attrs:{type:"success",icon:"el-icon-check",circle:"",size:"mini"}}):a("el-button",{attrs:{type:"danger",icon:"el-icon-close",circle:"",size:"mini"}})]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(i){return[a("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.checkUserDetail(i.row)}}},[t._v("详情")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.deleteUserByDepartment(i.row,e.$index)}}},[t._v("删除")])]}}],null,!0)})],1):a("div",{staticStyle:{color:"#AE3939"}},[t._v("\n                          对不起,"+t._s(e.row.name)+"暂时没有员工\n                      ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"departmentId",label:"部门id"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"部门名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"description",label:"说明"}}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(t){return[1==t.row.status?a("el-button",{attrs:{type:"success",icon:"el-icon-check",circle:"",size:"mini"}}):a("el-button",{attrs:{type:"danger",icon:"el-icon-close",circle:"",size:"mini"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"updateTime",label:"更新时间","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"250px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.openEdit(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.openDialog(e.row)}}},[t._v("增加用户")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.deleteItem(e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("el-dialog",{attrs:{title:"请选择要添加的员工",visible:t.addUserFlag},on:{"update:visible":function(e){t.addUserFlag=e}}},[a("el-select",{attrs:{placeholder:"请选择",size:"mini"},model:{value:t.addUserItem,callback:function(e){t.addUserItem=e},expression:"addUserItem"}},t._l(t.userList,function(t){return a("el-option",{key:t.userId,attrs:{label:t.username,value:t.userId,disabled:1==t.select}})}),1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t.addUserFlag=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.addUserToDepart}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"编辑部门",visible:t.editDepartFlag,width:"400px"},on:{"update:visible":function(e){t.editDepartFlag=e}}},[a("el-form",{ref:"formPerms",attrs:{model:t.departTmpItem,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"名称",required:""}},[a("el-input",{staticClass:"item_reset",attrs:{size:"mini"},model:{value:t.departTmpItem.name,callback:function(e){t.$set(t.departTmpItem,"name",e)},expression:"departTmpItem.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"说明"}},[a("el-input",{staticClass:"item_reset",attrs:{size:"mini"},model:{value:t.departTmpItem.description,callback:function(e){t.$set(t.departTmpItem,"description",e)},expression:"departTmpItem.description"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:function(e){t.editDepartFlag=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.editItem}},[t._v("确 定")])],1)],1),t._v(" "),a("add-item",{ref:"addPerm",attrs:{departmentItem:t.departmentItem},on:{"update:departmentItem":function(e){t.departmentItem=e},"update:department-item":function(e){t.departmentItem=e},submit:t.addItem}})],1)])},staticRenderFns:[]};var o=a("VU/8")(r,l,!1,function(t){a("pi0s")},"data-v-e078d7e8",null);e.default=o.exports}});
//# sourceMappingURL=6.eb788ed3a55aa10b30a0.js.map