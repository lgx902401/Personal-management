webpackJsonp([16],{"07Vf":function(e,t){},"5Dlg":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l={name:"permissionsDetail",data:function(){return{userId:this.$route.query.id,userItem:{},editFlag:!0,roleList:[],roleListAll:[],hasRoles:[],addRoleFlag:!1,roleItem:"",changePwdFlag:!1,chaPwd:{confirmNewPassword:"",newPassword:"",oldPassword:""}}},created:function(){this.getItem(),this.getRole()},methods:{back:function(){console.log(this.$route),this.$router.back(-1)},cancelEdit:function(){this.editFlag=!this.editFlag},saveItem:function(){var e=this,t=this.userItem;delete t.createTime,delete t.updateTime,delete t.lastLoginTime,console.log("user",t),post("/pms_api/user/edit",t).then(function(t){e.cancelEdit()}).catch(function(e){console.log(e)})},isAdmin:function(){var e=this;post("/pms_api/user/detail").then(function(t){"1"!=t.data.hasRoles[0]?e.$confirm("此操作仅限超级管理员使用,普通用户请前去个人中心修改密码","提示",{confirmButtonText:"确定",type:"warning"}).then(function(){}).catch(function(){}):e.changePwdFlag=!0}).catch(function(e){console.log(e)})},changePwd:function(){var e={newPassword:this.userItem.password,userId:this.userItem.userId};post("/pms_api/user/adminChangePassword",e).then(function(e){}).catch(function(e){console.log(e)}),this.changePwdFlag=!1},getItem:function(){var e=this;post("/pms_api/user/detail?userId="+this.userId).then(function(t){console.log("res",t),e.userItem=t.data.rows[0]}).catch(function(e){console.log(e)})},getRole:function(){var e=this;post("/pms_api/user/assign/role/list",{userId:this.userId}).then(function(t){for(var s in e.roleListAll=t.data.rows,e.hasRoles=t.data.hasRoles,e.roleList=[],e.hasRoles)for(var l in e.roleListAll)e.hasRoles[s]==e.roleListAll[l].roleId&&(e.roleList.push(e.roleListAll[l]),e.roleListAll[l].select="1")}).catch(function(e){console.log(e)})},addRole:function(){var e=this,t=this.hasRoles;t.push(this.roleItem);var s={userId:this.userItem.userId,roleIdStr:t};post("/pms_api/user/assign/role",s).then(function(t){e.getRole()}).catch(function(e){console.log(e)}),this.addRoleFlag=!this.addRoleFlag,this.roleItem=""},checkRole:function(e){this.$router.push({path:"/roleDetail",query:{title:e.name,id:e.roleId}})},deleteRole:function(e){var t=this;this.$confirm("此操作将取消该角色与用户的绑定，是否继续","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){delete t.hasRoles[e.$index];var s={userId:t.userItem.userId,roleIdStr:t.hasRoles};post("/pms_api/user/assign/role",s).then(function(e){t.getRole(),t.$message({type:"success",message:"删除成功!"})}).catch(function(e){console.log(e)})}).catch(function(e){})},cellStyle:function(e){e.row,e.colum,e.rowIndex,e.columIndex;return"text-align: center"},rowClass:function(e){e.row,e.rowIndex;return"text-align: center"}}},i={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ui-page"},[s("div",{staticClass:"ui-list ui-box"},[s("div",{staticClass:"box-header ui-list-header"},[s("div",[e._v(e._s(this.$route.query.title)+"详情")]),e._v(" "),s("div",[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.back}},[e._v("返回")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.isAdmin}},[e._v("修改密码")])],1)]),e._v(" "),s("div",{staticClass:"ui-detail-box"},[s("el-form",{staticClass:"ui-search-form",attrs:{"label-width":"120px"}},[s("el-form-item",{attrs:{label:"用户id"}},[s("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",disabled:""},model:{value:e.userItem.userId,callback:function(t){e.$set(e.userItem,"userId",t)},expression:"userItem.userId"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"名称"}},[s("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",disabled:e.editFlag},model:{value:e.userItem.username,callback:function(t){e.$set(e.userItem,"username",t)},expression:"userItem.username"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"邮箱"}},[s("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",disabled:e.editFlag},model:{value:e.userItem.email,callback:function(t){e.$set(e.userItem,"email",t)},expression:"userItem.email"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"手机"}},[s("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",disabled:e.editFlag},model:{value:e.userItem.phone,callback:function(t){e.$set(e.userItem,"phone",t)},expression:"userItem.phone"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"性别"}},[s("el-select",{staticClass:"ui-item-reset",attrs:{placeholder:"请选择",size:"mini",disabled:e.editFlag},model:{value:e.userItem.sex,callback:function(t){e.$set(e.userItem,"sex",t)},expression:"userItem.sex"}},[s("el-option",{attrs:{label:"男",value:1}}),e._v(" "),s("el-option",{attrs:{label:"女",value:2}})],1)],1),e._v(" "),s("el-form-item",{attrs:{label:"年龄"}},[s("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",disabled:e.editFlag},model:{value:e.userItem.age,callback:function(t){e.$set(e.userItem,"age",t)},expression:"userItem.age"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"状态"}},[s("el-select",{staticClass:"ui-item-reset",attrs:{placeholder:"请选择",size:"mini",disabled:e.editFlag},model:{value:e.userItem.status,callback:function(t){e.$set(e.userItem,"status",t)},expression:"userItem.status"}},[s("el-option",{attrs:{label:"禁用",value:2}}),e._v(" "),s("el-option",{attrs:{label:"启用",value:1}})],1)],1),e._v(" "),s("el-form-item",{attrs:{label:"创建时间"}},[s("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",disabled:""},model:{value:e.userItem.createTime,callback:function(t){e.$set(e.userItem,"createTime",t)},expression:"userItem.createTime"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"更新时间"}},[s("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",disabled:""},model:{value:e.userItem.updateTime,callback:function(t){e.$set(e.userItem,"updateTime",t)},expression:"userItem.updateTime"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"上次登录时间"}},[s("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",disabled:""},model:{value:e.userItem.lastLoginTime,callback:function(t){e.$set(e.userItem,"lastLoginTime",t)},expression:"userItem.lastLoginTime"}})],1)],1),e._v(" "),s("div",{staticClass:"ui-detail-btus"},[e.editFlag?s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.editFlag=!1}}},[e._v("编辑")]):s("el-button",{attrs:{size:"mini"},on:{click:e.cancelEdit}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini",disabled:e.editFlag},on:{click:e.saveItem}},[e._v("保存")])],1)],1)]),e._v(" "),s("div",{staticClass:"ui-list ui-box"},[s("div",{staticClass:"box-header ui-list-header"},[s("div",[e._v("用户关联角色")]),e._v(" "),s("div",[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.addRoleFlag=!0}}},[e._v("新增")])],1)]),e._v(" "),s("div",{staticClass:"ui-detail-box"},[s("el-table",{attrs:{data:e.roleList,"cell-style":e.cellStyle,"header-cell-style":e.rowClass}},[s("el-table-column",{attrs:{prop:"roleId",label:"角色ID"}}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"名称"}}),e._v(" "),s("el-table-column",{attrs:{prop:"description",label:"描述"}}),e._v(" "),s("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(e){return[1==e.row.status?s("el-button",{attrs:{type:"success",icon:"el-icon-check",circle:"",size:"mini"}}):s("el-button",{attrs:{type:"danger",icon:"el-icon-close",circle:"",size:"mini"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"createTime",label:"创建时间","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"updateTime",label:"更新时间","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini"},on:{click:function(s){return e.checkRole(t.row)}}},[e._v("详情")]),e._v(" "),s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(s){return e.deleteRole(t)}}},[e._v("删除")])]}}])})],1)],1)]),e._v(" "),s("el-dialog",{attrs:{title:"请选择要添加的角色",visible:e.addRoleFlag},on:{"update:visible":function(t){e.addRoleFlag=t}}},[s("el-select",{attrs:{placeholder:"请选择",size:"mini"},model:{value:e.roleItem,callback:function(t){e.roleItem=t},expression:"roleItem"}},e._l(e.roleListAll,function(e){return s("el-option",{key:e.roleId,attrs:{label:e.name,value:e.roleId,disabled:1==e.select}})}),1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.addRoleFlag=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.addRole}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"修改密码",visible:e.changePwdFlag,width:"400px"},on:{"update:visible":function(t){e.changePwdFlag=t}}},[s("el-form",{staticClass:"ui-search-form",attrs:{"label-width":"120px"}},[s("el-form-item",{attrs:{label:"新密码"}},[s("el-input",{staticClass:"ui-item-reset",attrs:{size:"mini",type:"password","show-password":""},model:{value:e.userItem.password,callback:function(t){e.$set(e.userItem,"password",t)},expression:"userItem.password"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.changePwdFlag=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.changePwd}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var a=s("VU/8")(l,i,!1,function(e){s("07Vf")},null,null);t.default=a.exports}});
//# sourceMappingURL=16.a45e855684eea6a0793d.js.map